select(UAAL_reported,UAAL_standard, revenue, Pop, city_contrib) %>%
summarise(UAAL_reported = sum(UAAL_reported),
UAAL_standard = sum(UAAL_standard),
Revenue = mean(revenue, na.rm = TRUE),
Population = mean(Pop, na.rm = TRUE),
city_contrib = sum(city_contrib, na.rm =TRUE))
#Pension Summary
pension.summary <- pension.raw %>%
group_by(City) %>%
summarise(Pension_reported =
sum(reported_pension),
Pension_standard =
sum(standardized_pension))
#combined dataframe with Pension + OPEB data
Pension.UL <- cbind(Pen_reported = pension.summary$Pension_reported,
Pen_standard = pension.summary$Pension_standard)
total.summary <- cbind(opeb.summary, Pension.UL)
#Adding Total Lialbility
total.summary <- total.summary %>%
mutate(total_reported = UAAL_reported + Pen_reported,
total_standard = UAAL_standard + Pen_standard)
#Adding Per capita Calculation
total.summary$Revenue[!is.finite(total.summary$Revenue)] <- NA  #Clean out Revenue
total.summary$Population[!is.finite(total.summary$Population)] <- NA #Clean out Population
total.summary <- total.summary %>%
mutate(total_reported.capita = total_reported/Population,
total_standard.capita = total_standard/Population)
total.summary <- total.summary %>%
mutate(UAAL_reported.capita = UAAL_reported/Population,
UAAL_standard.capita = UAAL_standard/Population)
total.summary <- total.summary %>%
mutate(Pen_reported.capita = Pen_reported/Population,
Pen_standard.capita = Pen_standard/Population)
#Adding share revenue
total.summary <- total.summary %>%
mutate(OPEB.share = round(100*(city_contrib/Revenue),2))
opeb.raw %>%
select(city, disc_rate) %>%
ggplot( aes(x=disc_rate)) +
geom_histogram(fill= "#F98400", color="black")+
geom_vline(aes(xintercept=mean(disc_rate, na.rm = TRUE)), color="black",
linetype="dashed")+
annotate("label", x = 0.053, y=4, label = "Average Discount Rate: 5.2%") +
scale_x_continuous(labels = scales::percent) +
labs(title="Fig 1. Reported Discount Rates \n (2017)",x="Discount Rate", y = "Count")+
theme_classic() +
theme(plot.title = element_text(hjust = 0.5))
total.summary$city <- as.factor(total.summary$city)
total.summary %>%
#filter(city != "Denver") %>%
#filter(city != "Columbus") %>%
select(city, UAAL_reported, UAAL_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`UAAL_reported`="Reported",
`UAAL_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity", position="dodge",width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 7200, label = "NOT DRAWN TO SCALE \n Reported: $88,400 - Standardized: $90,800", size=3) +
annotate("segment", x = 17, xend = 16, y = 7300, yend = 7300, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom Into graph
coord_flip(ylim = c(0,10000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 2. OPEB Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
mean(total.summary$UAAL_reported,na.rm = TRUE)
round(mean(total.summary$UAAL_reported,na.rm = TRUE),1)
round(mean(total.summary$UAAL_reported,na.rm = TRUE)/(10^6),1)
round(mean(total.summary$UAAL_standard,na.rm = TRUE)/(10^6),1)
View(total.summary)
total.summary$city <- as.factor(total.summary$city)
total.summary %>%
#filter(city != "Denver") %>%
#filter(city != "Columbus") %>%
select(city, UAAL_reported, UAAL_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`UAAL_reported`="Reported",
`UAAL_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity", position="dodge",width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 7200, label = "NOT DRAWN TO SCALE \n Reported: $88,400 - Standardized: $77,880", size=3) +
annotate("segment", x = 17, xend = 16, y = 7300, yend = 7300, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom Into graph
coord_flip(ylim = c(0,10000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 2. OPEB Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary$city <- as.factor(total.summary$city)
total.summary %>%
#filter(city != "Denver") %>%
#filter(city != "Columbus") %>%
select(city, UAAL_reported, UAAL_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`UAAL_reported`="Reported",
`UAAL_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity", position="dodge",width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 7200, label = "NOT DRAWN TO SCALE \n Reported: $88,400 - Standardized: $77,880", size=3) +
annotate("segment", x = 17, xend = 16, y = 7300, yend = 7300, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom Into graph
coord_flip(ylim = c(0,10000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 2. OPEB Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
filter(city != "Columbus" & city != "Denver") %>%
select(city, UAAL_reported.capita, UAAL_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`UAAL_reported.capita`="Reported",
`UAAL_standard.capita`="Standardized")) %>%
#mutate(value = if_else(variable == "Reported", -(value), value)) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity", position = "dodge",width = .9) +
coord_flip() +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 3. OPEB Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
filter(city != "Columbus") %>%
ggplot(aes(x = city, y = OPEB.share/100)) + geom_bar(stat = "identity",fill = "#F98400") +
scale_y_continuous(labels = scales::percent) +
theme_classic() + coord_flip() +
xlab("City") + ylab("Share of Revenue") +
ggtitle("Fig 4. OPEB Benefit Payment as share of 2017 Revenue \n (reported values)") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Revenue Share (%)")
total.summary %>%
select(city, Pen_reported, Pen_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`Pen_reported`="Reported",
`Pen_standard`="Standardized")) %>%
# mutate(value = if_else(variable == "Reported", -(value/1000), value/1000)) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 200000, label = "NOT DRAWN TO SCALE \n Standardized: $712,554", size=3) +
annotate("segment", x = 17, xend = 16, y = 200000, yend = 200000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,400000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels = dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 5. Pension Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, Pen_reported, Pen_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`Pen_reported`="Reported",
`Pen_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 200000, label = "NOT DRAWN TO SCALE \n Standardized: $726,590", size=3) +
annotate("segment", x = 17, xend = 16, y = 200000, yend = 200000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,400000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels = dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 5. Pension Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, Pen_reported, Pen_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`Pen_reported`="Reported",
`Pen_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 200000, label = "NOT DRAWN TO SCALE \n Standardized: $726,590", size=3) +
annotate("segment", x = 17, xend = 16, y = 200000, yend = 200000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,400000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels = dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 2. Pension Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
round(mean(total.summary$Pen_reported.capita,na.rm=TRUE)/(10^6),1)
round(mean(total.summary$Pen_reported.capita,na.rm=TRUE)/(10^6),1))
round(mean(total.summary$Pen_reported.capita,na.rm=TRUE),1))
round(mean(total.summary$Pen_reported.capita,na.rm=TRUE),1)
round(mean(total.summary$Pen_reported.capita,na.rm=TRUE),1)*100
round(mean(total.summary$Pen_reported.capita,na.rm=TRUE),1)*1000
round(mean(total.summary$Pen_standard.capita,na.rm=TRUE),1)*1000
total.summary %>%
select(city, Pen_reported.capita, Pen_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`Pen_reported.capita`="Reported",
`Pen_standard.capita`="Standardized")) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: San Francisco
annotate("label", x = 18, y = 75000, label = "NOT DRAWN TO SCALE \n Standardized: $189,945", size=3) +
annotate("segment", x = 19, xend = 20, y = 75000, yend = 75000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,100000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 6. Pension Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, Pen_reported.capita, Pen_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`Pen_reported.capita`="Reported",
`Pen_standard.capita`="Standardized")) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: San Francisco
annotate("label", x = 18, y = 75000, label = "NOT DRAWN TO SCALE \n Standardized: $193,257", size=3) +
annotate("segment", x = 19, xend = 20, y = 75000, yend = 75000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,100000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 6. Pension Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, Pen_reported.capita, Pen_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`Pen_reported.capita`="Reported",
`Pen_standard.capita`="Standardized")) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: San Francisco
annotate("label", x = 18, y = 75000, label = "NOT DRAWN TO SCALE \n Standardized: $193,260", size=3) +
annotate("segment", x = 19, xend = 20, y = 75000, yend = 75000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,100000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 6. Pension Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, Pen_reported.capita, Pen_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`Pen_reported.capita`="Reported",
`Pen_standard.capita`="Standardized")) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: San Francisco
annotate("label", x = 18, y = 75000, label = "NOT DRAWN TO SCALE \n Standardized: $193,260", size=3) +
annotate("segment", x = 19, xend = 20, y = 75000, yend = 75000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,100000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 3. Pension Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary$city <- as.factor(total.summary$city)
total.summary %>%
#filter(city != "Denver") %>%
#filter(city != "Columbus") %>%
select(city, UAAL_reported, UAAL_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`UAAL_reported`="Reported",
`UAAL_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity", position="dodge",width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 7200, label = "NOT DRAWN TO SCALE \n Reported: $88,400 - Standardized: $77,880", size=3) +
annotate("segment", x = 17, xend = 16, y = 7300, yend = 7300, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom Into graph
coord_flip(ylim = c(0,10000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 2. OPEB Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary$city <- as.factor(total.summary$city)
total.summary %>%
#filter(city != "Denver") %>%
#filter(city != "Columbus") %>%
select(city, UAAL_reported, UAAL_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`UAAL_reported`="Reported",
`UAAL_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity", position="dodge",width = .9) +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 7200, label = "NOT DRAWN TO SCALE \n Reported: $88,400 - Standardized: $77,880", size=3) +
annotate("segment", x = 17, xend = 16, y = 7300, yend = 7300, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom Into graph
coord_flip(ylim = c(0,10000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 4. OPEB Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
filter(city != "Columbus" & city != "Denver") %>%
select(city, UAAL_reported.capita, UAAL_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`UAAL_reported.capita`="Reported",
`UAAL_standard.capita`="Standardized")) %>%
#mutate(value = if_else(variable == "Reported", -(value), value)) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity", position = "dodge",width = .9) +
coord_flip() +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels=dollar)+
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 5. OPEB Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
filter(city != "Columbus") %>%
ggplot(aes(x = city, y = OPEB.share/100)) + geom_bar(stat = "identity",fill = "#F98400") +
scale_y_continuous(labels = scales::percent) +
theme_classic() + coord_flip() +
xlab("City") + ylab("Share of Revenue") +
ggtitle("Fig 4. OPEB Benefit Payment as share of 2017 Revenue \n (reported values)") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Revenue Share (%)")
total.summary %>%
filter(city != "Columbus") %>%
ggplot(aes(x = city, y = OPEB.share/100)) + geom_bar(stat = "identity",fill = "#F98400") +
scale_y_continuous(labels = scales::percent) +
theme_classic() + coord_flip() +
xlab("City") + ylab("Share of Revenue") +
ggtitle("Fig 6. OPEB Benefit Payment as share of 2017 Revenue \n (reported values)") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Revenue Share (%)")
total.summary %>%
select(city, total_reported, total_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`total_reported`="Reported",
`total_standard`="Standardized")) %>%
#mutate(value = if_else(variable == "Reported", -(value/1000), value/1000)) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position="dodge") +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 200000, label = "NOT DRAWN TO SCALE \n Standardized: $803,309", size=3) +
annotate("segment", x = 17, xend = 16, y = 200000, yend = 200000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,400000)) +
scale_y_continuous(labels=dollar)+
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 7. Total Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, total_reported.capita, total_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`total_reported.capita`="Reported",
`total_standard.capita`="Standardized")) %>%
#mutate(value = if_else(variable == "Reported", -(value), value)) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: san Francisco
annotate("label", x = 18, y = 75000, label = "NOT DRAWN TO SCALE \n Standardized: $195,895", size=3) +
annotate("segment", x = 19, xend = 20, y = 75000, yend = 75000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,100000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels = dollar) +
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 8. Total Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, total_reported, total_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`total_reported`="Reported",
`total_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position="dodge") +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 200000, label = "NOT DRAWN TO SCALE \n Standardized: $803,309", size=3) +
annotate("segment", x = 17, xend = 16, y = 200000, yend = 200000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,400000)) +
scale_y_continuous(labels=dollar)+
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 7. Total Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, total_reported, total_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`total_reported`="Reported",
`total_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position="dodge") +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 200000, label = "NOT DRAWN TO SCALE \n Standardized: $804,000", size=3) +
annotate("segment", x = 17, xend = 16, y = 200000, yend = 200000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,400000)) +
scale_y_continuous(labels=dollar)+
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 7. Total Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
mean(total.summary$total_reported,na.rm = TRUE)/(10^6)
mean(total.summary$total_standard,na.rm = TRUE)/(10^6)
total.summary %>%
select(city, total_reported, total_standard) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`total_reported`="Reported",
`total_standard`="Standardized")) %>%
ggplot(aes(x = city, y = value/1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position="dodge") +
#Add Outlier Textbox: New York
annotate("label", x = 18, y = 200000, label = "NOT DRAWN TO SCALE \n Standardized: $804,000", size=3) +
annotate("segment", x = 17, xend = 16, y = 200000, yend = 200000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,400000)) +
scale_y_continuous(labels=dollar)+
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
theme_classic() + xlab("City") +
ylab("Unfunded Liability (in millions)") +
ggtitle("Fig 7. Total Liability ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
total.summary %>%
select(city, total_reported.capita, total_standard.capita) %>%
melt(id.vars="city") %>%
mutate(variable = recode(variable,
`total_reported.capita`="Reported",
`total_standard.capita`="Standardized")) %>%
#mutate(value = if_else(variable == "Reported", -(value), value)) %>%
ggplot(aes(x = city, y = value*1000, group = variable, fill = variable)) +
geom_bar(stat = "identity",position = "dodge", width = .9) +
#Add Outlier Textbox: san Francisco
annotate("label", x = 18, y = 75000, label = "NOT DRAWN TO SCALE \n Standardized: $198,000", size=3) +
annotate("segment", x = 19, xend = 20, y = 75000, yend = 75000, colour = "black", arrow=arrow(length = unit(0.2, "cm")), size= 0.1) +
#Zoom into graph
coord_flip(ylim = c(0,100000)) +
scale_fill_manual(values= c(wes_palette(n=1, name="Royal1"),"#F98400")) +
scale_y_continuous(labels = dollar) +
theme_classic() + xlab("City") +
ylab("Unfunded Liability per capita") +
ggtitle("Fig 8. Total Liability per capita ") +
theme(plot.title = element_text(hjust = 0.5)) +
labs(fill = "Valuation Type")
round(mean(total.summary$total_standard.capita,na.rm = TRUE),1)
sum(total.summary$Pen_reported,na.rm = TRUE)
sum(total.summary$Pen_reported,na.rm = TRUE)/(10^6)
sum(total.summary$Pen_standard,na.rm = TRUE)/(10^6)
sum(total.summary$UAAL_standard,na.rm = TRUE)/(10^6)
140.6+113.1
1863.8+11.3
1863.8+111.3
round(mean(total.summary$Pen_standard.capita,na.rm=TRUE),1)*1000
